/* *********************************** *//*                                     *//*      Lem-in project                 *//*                                     *//*      Created by Artur Makhnach      *//*      github.com/DippyArtu           *//*      artum.me                       *//*                                     *//* *********************************** */#include <lem-in.h>int 						process_room(char *line, t_map *map, int flag){	t_room_node 			*new_room;	size_t					len;	len = 0;	if (!line || line[0] == '\0')	{		free(line);		error(INVALID_LINE_ERR, map);	}	len = validate_room_name(line, map);	if (!len)		return 1;	new_room = init_room();	new_room->room_name = strndup(line, --len);	line += ++len;	if (!(ht_search(map->coordinates, line)))		ht_insert(map->coordinates, line, map->dummy);	else		error(DUPLICATE_COORD_ERR, map);	new_room->x = get_room_coordinate(&line, map);	if (!line || *line != ' ')		error(INVALID_COORD_ERR, map);	line++;	new_room->y = get_room_coordinate(&line, map);	if (*line != '\0')		error(INVALID_LINE_ERR, map);	record_room(map, new_room, flag);	return 0;}void 						process_comment(char *line, t_map *map, int fd){	int 					err;	err = 1;	if (line[1] == '#')	{		if (ft_strcmp(line, "##start") == 1)		{			if (map->start)				error(START_FLAG_ERR, map);			if ((err = get_next_line(fd, &line)) == 1)				process_room(line, map, START);			free(line);		}		else if (ft_strcmp(line, "##end") == 1)		{			if (map->end)				error(END_FLAG_ERR, map);			if ((err = get_next_line(fd, &line)) == 1)				process_room(line, map, END);			free(line);		}	}	if (err <= 0)		error(FILE_READ_ERR, map);}void 						get_num_ants(int fd, t_map *map, char *line){	if (get_next_line(fd, &line) != 1)	{		free(line);		error(FILE_READ_ERR, map);	}	if ((!isdigit(line[0])) || (map->num_ants = ft_atoi(line)) <= 0)	{		free(line);		error(ANT_NUM_ERR, map);	}	free(line);}char 						*get_rooms(int fd, t_map *map){	char 					*line;	int 					err;	err = 0;	line = NULL;	get_num_ants(fd, map, line);	while ((err = get_next_line(fd, &line)) == 1)	{		if (line[0] == '#')			process_comment(line, map, fd);		else if (isdigit(line[0]) || isalpha(line[0]))		{			if (process_room(line, map, NONE) == 1)				return line;		}		else		{			free(line);			error(INVALID_LINE_ERR, map);		}		free(line);	}	free(line);	if (err < 0)		error(FILE_READ_ERR, map);	error(NO_LINKS_ERR, map);	return NULL; // —— should never be reached}